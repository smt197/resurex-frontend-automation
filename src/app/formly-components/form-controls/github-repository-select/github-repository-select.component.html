<mat-form-field appearance="outline" class="w-full">
  <mat-label>{{ props.label }}</mat-label>

  <mat-select
    [formControl]="formControl"
    [placeholder]="props.placeholder || 'Select a repository'"
    [disabled]="isDisabled">

    <!-- Search Input -->
    <div class="search-input-container">
      <mat-icon class="search-icon">search</mat-icon>
      <input
        type="text"
        class="search-input"
        placeholder="Search repositories..."
        (input)="onSearchInput($event)"
        (click)="$event.stopPropagation()"
        [value]="searchTerm"
      />
    </div>

    <!-- Loading State -->
    <mat-option *ngIf="loading" disabled>
      <mat-icon class="loading-spinner">refresh</mat-icon>
      Loading repositories...
    </mat-option>

    <!-- Repository Options -->
    <mat-option
      *ngFor="let repo of filteredRepositories"
      [value]="repo.slug">
      {{ getRepositoryLabel(repo) }}
    </mat-option>

    <!-- No Results -->
    <mat-option *ngIf="!loading && filteredRepositories.length === 0" disabled>
      <mat-icon>info</mat-icon>
      {{ searchTerm ? 'No repositories found' : 'No repositories available' }}
    </mat-option>
  </mat-select>

  <mat-icon matPrefix>source</mat-icon>

  <mat-hint *ngIf="props.description">{{ props.description }}</mat-hint>

  <mat-error *ngIf="showError">
    {{ formControl.errors?.['required'] ? (props['validationMessages']?.['required'] || 'Repository is required') : 'Invalid selection' }}
  </mat-error>
</mat-form-field>
