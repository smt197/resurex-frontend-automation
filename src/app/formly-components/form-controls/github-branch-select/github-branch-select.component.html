<mat-form-field appearance="outline" class="w-full">
  <mat-label>{{ props.label }}</mat-label>

  <mat-select
    [formControl]="formControl"
    [placeholder]="props.placeholder || 'Select a branch'"
    [disabled]="isDisabled">

    <!-- Search Input -->
    <div class="search-input-container">
      <mat-icon class="search-icon">search</mat-icon>
      <input
        type="text"
        class="search-input"
        placeholder="Search branches..."
        (input)="onSearchInput($event)"
        (click)="$event.stopPropagation()"
        [value]="searchTerm"
      />
    </div>

    <!-- Loading State -->
    <mat-option *ngIf="loading" disabled>
      <mat-icon class="loading-spinner">refresh</mat-icon>
      Loading branches...
    </mat-option>

    <!-- Branch Options -->
    <mat-option
      *ngFor="let branch of filteredBranches"
      [value]="branch.name">
      {{ getBranchLabel(branch) }}
    </mat-option>

    <!-- No Results -->
    <mat-option *ngIf="!loading && filteredBranches.length === 0" disabled>
      <mat-icon>info</mat-icon>
      {{ searchTerm ? 'No branches found' : 'No branches available' }}
    </mat-option>
  </mat-select>

  <mat-icon matPrefix>device_hub</mat-icon>

  <mat-hint *ngIf="props.description">{{ props.description }}</mat-hint>

  <mat-error *ngIf="showError">
    {{ formControl.errors?.['required'] ? (props['validationMessages']?.['required'] || 'Branch is required') : 'Invalid selection' }}
  </mat-error>
</mat-form-field>
