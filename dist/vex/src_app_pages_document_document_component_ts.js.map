{"version":3,"file":"src_app_pages_document_document_component_ts.js","mappings":"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","sources":["./src/app/pages/document/delete-element-component/delete-element.component.ts","./src/app/pages/document/delete-element-component/delete-element.component.html","./src/app/pages/document/document.component.ts","./src/app/pages/document/document.component.html"],"sourcesContent":["import { Component, Inject } from '@angular/core';\r\nimport {\r\n  MAT_DIALOG_DATA,\r\n  MatDialogModule,\r\n  MatDialogRef\r\n} from '@angular/material/dialog';\r\nimport { NgIf } from '@angular/common';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatDividerModule } from '@angular/material/divider';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { Document } from 'src/app/interfaces/Document';\r\n\r\n@Component({\r\n  selector: 'vex-delete-element-component',\r\n  standalone: true,\r\n  imports: [\r\n    MatDialogModule,\r\n    NgIf,\r\n    MatButtonModule,\r\n    MatIconModule,\r\n    MatDividerModule\r\n  ],\r\n  templateUrl: './delete-element.component.html',\r\n  styleUrl: './delete-element.component.scss'\r\n})\r\nexport class DeleteElementComponent {\r\n  constructor(\r\n    @Inject(MAT_DIALOG_DATA) public defaults: Document | Document[],\r\n    private dialogRef: MatDialogRef<DeleteElementComponent>\r\n  ) {}\r\n\r\n  send() {\r\n    this.dialogRef.close(this.defaults);\r\n  }\r\n\r\n  isSingleDocument(): boolean {\r\n    return !Array.isArray(this.defaults);\r\n  }\r\n\r\n  getSingleDocumentName(): string {\r\n    if (this.isSingleDocument()) {\r\n      const document = this.defaults as Document;\r\n      return `${document.name}`;\r\n    }\r\n    const documents = this.defaults as Document[];\r\n    return documents.length + '';\r\n  }\r\n}\r\n","<div class=\"container p-6\">\r\n    <div class=\"flex items-start justify-between\" mat-dialog-title>\r\n        <div class=\"flex items-start justify-start gap-2\">\r\n            <mat-icon color=\"warn\" svgIcon=\"mat:delete\"></mat-icon>\r\n            <h2 class=\"headline m-0 flex-auto\">\r\n                Delete Object\r\n            </h2>\r\n        </div>\r\n    </div>\r\n\r\n    <mat-divider class=\"text-border\"></mat-divider>\r\n\r\n    <mat-dialog-content class=\"flex flex-col items-start justify-start space-y-2\">\r\n        <!-- Affichage des informations de l'utilisateur -->\r\n        <ng-container *ngIf=\"isSingleDocument(); else docList\">\r\n            <p class=\"text-lg text-red-500 font-medium\">Are you sure you want to delete?</p>\r\n            <p class=\"text-lg font-semibold\">\r\n                DOCUMENT: {{ getSingleDocumentName() }}\r\n            </p>\r\n        </ng-container>\r\n        <!-- Affichage pour un tableau d'utilisateurs -->\r\n        <ng-template #docList>\r\n            <p class=\"text-lg text-red-500 font-medium\">Are you sure you want to delete all documents?</p>\r\n            <p class=\"text-lg font-semibold\">\r\n                NUMBERS: {{ getSingleDocumentName() }}\r\n            </p>\r\n        </ng-template>\r\n    </mat-dialog-content>\r\n\r\n    <mat-dialog-actions align=\"end\">\r\n        <button mat-button mat-dialog-close type=\"button\">Cancel</button>\r\n        <button color=\"primary\" mat-flat-button type=\"submit\" (click)=\"send()\">\r\n            Delete\r\n        </button>\r\n    </mat-dialog-actions>\r\n</div>","import { Component, OnInit, ViewChild, signal } from '@angular/core'; // Added OnInit\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatSnackBar } from '@angular/material/snack-bar';\r\nimport { GenericResourceListComponent } from 'src/app/shared/generic-resource-list/generic-resource-list.component';\r\nimport { ActionEvent } from 'src/app/shared/dynamic-data-table/Dynamic-Table-Interface';\r\nimport { getDocumentFormlyFields } from 'src/app/models/document.model';\r\nimport { ResourceService } from 'src/app/shared/generic-resource-list/generic-method-interface';\r\nimport { GenericApiService } from 'src/app/services/generic-api.service';\r\nimport { TranslateModule, TranslateService } from '@ngx-translate/core';\r\nimport { DocumentShowComponent } from './document-show/document-show.component';\r\nimport { DeleteElementComponent } from './delete-element-component/delete-element.component';\r\nimport { Router } from '@angular/router';\r\nimport { MatDialog } from '@angular/material/dialog';\r\nimport { Document } from 'src/app/interfaces/Document';\r\nimport { finalize, map, Observable } from 'rxjs';\r\nimport { Utils } from 'src/app/classes/Utils';\r\nimport { DocumentService } from './document.service';\r\nimport { FormlyFieldConfig } from '@ngx-formly/core';\r\nimport { WebsocketService } from 'src/app/services/websocket.service';\r\nimport { UploadStatusService } from 'src/app/services/upload-status.service';\r\n\r\n@Component({\r\n  selector: 'vex-document',\r\n  standalone: true,\r\n  imports: [CommonModule, GenericResourceListComponent, TranslateModule],\r\n  templateUrl: './document.component.html'\r\n})\r\nexport class DocumentComponent implements OnInit {\r\n  type = 'documents';\r\n  isLoading = signal(true);\r\n  dataService: ResourceService<Document>;\r\n  activeJobsCount$: Observable<number>;\r\n  @ViewChild(GenericResourceListComponent)\r\n  resourceList!: GenericResourceListComponent<Document>;\r\n  formlyFields: FormlyFieldConfig[] = [];\r\n\r\n  constructor(\r\n    private genericApi: GenericApiService,\r\n    private snackbar: MatSnackBar,\r\n    private translate: TranslateService,\r\n    private router: Router,\r\n    private dialog: MatDialog,\r\n    private websocketService: WebsocketService,\r\n    private uploadStatusService: UploadStatusService,\r\n    private documentService: DocumentService\r\n  ) {\r\n    this.dataService = Utils.createDataService<Document>(\r\n      this.type,\r\n      this.genericApi\r\n    );\r\n    this.activeJobsCount$ = this.websocketService.activeJobs$.pipe(\r\n      map((jobs) => jobs.length)\r\n    );\r\n\r\n    // Synchroniser les jobs WebSocket avec le service d'upload\r\n    this.websocketService.activeJobs$.subscribe((jobs) => {\r\n      const currentTime = Date.now();\r\n\r\n      jobs.forEach((job) => {\r\n        if (job.input?.type === 'document' && job.input?.main_document_id) {\r\n          const progress = (job.progress_now / job.progress_max) * 100;\r\n          const docId = `doc-${job.input.main_document_id}`;\r\n\r\n          // Si c'est un nouveau job, démarrer le tracking\r\n          if (!this.uploadStatusService.isUploadInProgress(docId)) {\r\n            this.uploadStatusService.startUpload(\r\n              docId,\r\n              job.input.main_document_id\r\n            );\r\n          }\r\n\r\n          // Mettre à jour le progrès\r\n          this.uploadStatusService.updateProgress(docId, progress, job.id);\r\n        }\r\n      });\r\n    });\r\n\r\n    // Écouter les jobs terminés\r\n    this.websocketService.jobFinished$.subscribe((finishedJob) => {\r\n      if (finishedJob.input?.main_document_id) {\r\n        this.uploadStatusService.completeUpload(\r\n          `doc-${finishedJob.input.main_document_id}`\r\n        );\r\n      }\r\n    });\r\n\r\n    // Écouter les nouveaux documents créés pour actualiser la liste\r\n    this.documentService.documentCreated$.subscribe((newDocument) => {\r\n      // Actualiser la liste après un petit délai pour voir le preloader\r\n      setTimeout(() => {\r\n        if (this.resourceList) {\r\n          this.resourceList.refresh();\r\n        }\r\n      }, 500);\r\n    });\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.formlyFields = getDocumentFormlyFields(this.translate);\r\n  }\r\n\r\n  handleAction(event: ActionEvent<Document>) {\r\n    switch (event.action) {\r\n      case 'create':\r\n        this.router.navigate(['index/document/create']);\r\n        break;\r\n\r\n      case 'edit':\r\n        if (event.row) {\r\n          this.router.navigate(['index/document/edit', event.row.id]);\r\n        }\r\n        break;\r\n\r\n      case 'show':\r\n        if (event.row?.name) {\r\n          // On redirige vers la nouvelle page de grille média\r\n          this.router.navigate(['index/media-grid', event.row.name]);\r\n        }\r\n        break;\r\n\r\n      case 'delete':\r\n        if (event.row) {\r\n          this.openDeleteDocumentDialog(event.row);\r\n        }\r\n        break;\r\n\r\n      case 'deleteAll':\r\n        if (event.rows) {\r\n          this.openDeleteAllDocumentDialog(event.rows);\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  openDeleteDocumentDialog(document: Document) {\r\n    this.dialog\r\n      .open(DeleteElementComponent, { data: document, width: '600px' })\r\n      .afterClosed()\r\n      .subscribe((confirmed) => {\r\n        if (confirmed) {\r\n          const originalData = [...this.resourceList.data];\r\n          this.resourceList.data = this.resourceList.data.filter(\r\n            (d) => d.slug !== document.slug\r\n          );\r\n\r\n          if (document.slug) {\r\n            this.resourceList.isLoading.set(true);\r\n            this.genericApi\r\n              .delete(this.type, document.slug)\r\n              .pipe(\r\n                // 3. Utiliser finalize pour garantir l'exécution, que ce soit un succès ou une erreur\r\n                finalize(() => {\r\n                  // Le spinner est désactivé à la fin de l'opération, MAIS c'est le refresh qui s'en chargera\r\n                  // en mettant isLoading à false, donc cette ligne n'est pas nécessaire si on refresh toujours.\r\n                  // this.genericListComponent.isLoading.set(false);\r\n                })\r\n              )\r\n              .subscribe({\r\n                next: (res) => {\r\n                  if (res) {\r\n                    this.showMessage(res.message);\r\n                    this.resourceList.refresh();\r\n                  }\r\n                },\r\n                error: (err) => {\r\n                  this.resourceList.data = originalData;\r\n                  this.showMessage(err.error.message);\r\n                  this.resourceList.refresh();\r\n                }\r\n              });\r\n          }\r\n        }\r\n      });\r\n  }\r\n  openDeleteAllDocumentDialog(documents: Document[]) {\r\n    this.dialog\r\n      .open(DeleteElementComponent, { data: documents, width: '600px' })\r\n      .afterClosed()\r\n      .subscribe((confirmed) => {\r\n        if (confirmed) {\r\n          const slugs = documents.map((document) => document.slug);\r\n          this.resourceList.isLoading.set(true);\r\n          this.genericApi\r\n            .deleteAll(this.type, slugs)\r\n            .pipe(finalize(() => this.resourceList.refresh()))\r\n            .subscribe((res) => {\r\n              if (res) {\r\n                this.showMessage(res.message);\r\n                this.isLoading.set(false);\r\n                this.resourceList.refresh();\r\n              }\r\n            });\r\n        }\r\n      });\r\n  }\r\n\r\n  showMessage(params: string | undefined) {\r\n    if (params) {\r\n      this.snackbar.open(params, 'Fermer', { duration: 5000 });\r\n    }\r\n  }\r\n\r\n  getDocumentUploadStatus(document: Document) {\r\n    return this.uploadStatusService.getUploadStatus(`doc-${document.id}`);\r\n  }\r\n\r\n  isDocumentUploading(document: Document): boolean {\r\n    return this.uploadStatusService.isUploadInProgress(`doc-${document.id}`);\r\n  }\r\n\r\n  openShowDocumentDialog(document: Document) {\r\n    this.dialog.open(DocumentShowComponent, { data: document, width: '650px' });\r\n  }\r\n}\r\n","<vex-generic-resource-list\n  [type]=\"type\"\n  [formlyFields]=\"formlyFields\"\n  [dataService]=\"dataService\"\n  [activeJobsCount]=\"(activeJobsCount$ | async) || 0\"\n  (action)=\"handleAction($event)\">\n</vex-generic-resource-list>"],"names":["MAT_DIALOG_DATA","MatDialogModule","NgIf","MatButtonModule","MatDividerModule","MatIconModule","i0","ɵɵelementContainerStart","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵelementContainerEnd","ɵɵadvance","ɵɵtextInterpolate1","ctx_r0","getSingleDocumentName","ctx_r1","DeleteElementComponent","constructor","defaults","dialogRef","send","close","isSingleDocument","Array","isArray","document","name","documents","length","ɵɵdirectiveInject","i1","MatDialogRef","selectors","standalone","features","ɵɵStandaloneFeature","decls","vars","consts","template","DeleteElementComponent_Template","rf","ctx","ɵɵelement","ɵɵtemplate","DeleteElementComponent_ng_container_8_Template","DeleteElementComponent_ng_template_9_Template","ɵɵtemplateRefExtractor","ɵɵlistener","DeleteElementComponent_Template_button_click_14_listener","ɵɵproperty","_r2","MatDialogClose","MatDialogTitle","MatDialogActions","MatDialogContent","i2","MatButton","i3","MatIcon","i4","MatDivider","styles","signal","CommonModule","GenericResourceListComponent","getDocumentFormlyFields","TranslateModule","DocumentShowComponent","finalize","map","Utils","DocumentComponent","genericApi","snackbar","translate","router","dialog","websocketService","uploadStatusService","documentService","type","isLoading","formlyFields","dataService","createDataService","activeJobsCount$","activeJobs$","pipe","jobs","subscribe","currentTime","Date","now","forEach","job","input","main_document_id","progress","progress_now","progress_max","docId","isUploadInProgress","startUpload","updateProgress","id","jobFinished$","finishedJob","completeUpload","documentCreated$","newDocument","setTimeout","resourceList","refresh","ngOnInit","handleAction","event","action","navigate","row","openDeleteDocumentDialog","rows","openDeleteAllDocumentDialog","open","data","width","afterClosed","confirmed","originalData","filter","d","slug","set","delete","next","res","showMessage","message","error","err","slugs","deleteAll","params","duration","getDocumentUploadStatus","getUploadStatus","isDocumentUploading","openShowDocumentDialog","GenericApiService","MatSnackBar","TranslateService","Router","i5","MatDialog","i6","WebsocketService","i7","UploadStatusService","i8","DocumentService","viewQuery","DocumentComponent_Query","DocumentComponent_Template_vex_generic_resource_list_action_0_listener","$event","ɵɵpipeBind1","i9","AsyncPipe","encapsulation"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}